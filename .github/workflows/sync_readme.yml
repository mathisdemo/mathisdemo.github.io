name: Update About Page from External README

on:
  push:
    branches:
      - master
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'  # ExÃ©cution tous les jours Ã  minuit UTC

jobs:
  list_repositories:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Download README.md from external repo
        run: |
          mkdir -p temp
          curl -f -o temp/README.md https://raw.githubusercontent.com/mathisdemo/Mathisdemo/master/README.md
          if [ $? -ne 0 ]; then 
            echo "âŒ Ã‰chec du tÃ©lÃ©chargement du README.md"; 
            exit 1
          fi

      - name: Extract content before "## ðŸ› ï¸ Skills"
        run: |
          awk '/## ðŸ› ï¸ Skills/ {exit} {print}' temp/README.md > temp/extracted.md

      - name: Clean extracted README.md
        run: |
          # Supprimer la phrase "ðŸš€ About Me"
          sed -i '/ðŸš€ About Me/d' temp/extracted.md

          # Supprimer tous les titres Markdown en supprimant les "#"
          sed -i 's/^#* //g' temp/extracted.md

      - name: Convert extracted content to about.md
        run: |
          mkdir -p _abouts
          
          # CrÃ©ation de la structure de about.md
          cat <<EOF > _abouts/about.md
          ---
          layout: page
          title: About
          ---
          
          EOF
          
          # Ajouter la section extraite et nettoyÃ©e
          cat temp/extracted.md >> _abouts/about.md

      - name: Check for changes
        run: |
          if git diff --quiet _abouts/about.md; then
            echo "âœ… Aucun changement dÃ©tectÃ©, fin du workflow."
            exit 0
          fi

      - name: Commit and push changes
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add _abouts/about.md
          git commit -m "ðŸ”„ Auto-update about.md from external README.md" || exit 0
          git push
